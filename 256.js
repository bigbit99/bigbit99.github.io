"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[256],{92309:(e,n,t)=>{t.d(n,{Z:()=>Z});var r,a,o,l,i,c,u=t(5996),s=t(85802);function d(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var p=u.Z.div(r||(r=d(["\n  display: flex;\n  width: 100%;\n  padding: 20px;\n  padding-top: 0;\n"]))),f=u.Z.form(a||(a=d(["\n  color: rgb(29, 28, 29);\n  font-size: 15px;\n  width: 100%;\n  border-radius: 4px;\n  border: 1px solid rgb(29, 28, 29);\n"]))),m=(0,u.Z)(s.r)(o||(o=d(["\n  font-family: Slack-Lato, appleLogo, sans-serif;\n  font-size: 15px;\n  padding: 8px 9px;\n  width: 100%;\n  & strong {\n    background: skyblue;\n  }\n  & textarea {\n    height: 44px;\n    padding: 9px 10px !important;\n    outline: none !important;\n    border-radius: 4px !important;\n    resize: none !important;\n    line-height: 22px;\n    border: none;\n  }\n  & ul {\n    border: 1px solid lightgray;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 9px 10px;\n    background: white;\n    border-radius: 4px;\n    width: 150px;\n  }\n"]))),h=u.Z.div(l||(l=d(["\n  position: relative;\n  background: rgb(248, 248, 248);\n  height: 41px;\n  display: flex;\n  border-top: 1px solid rgb(221, 221, 221);\n  align-items: center;\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n"]))),g=u.Z.button(i||(i=d(["\n  position: absolute;\n  right: 5px;\n  top: 5px;\n"]))),b=u.Z.button(c||(c=d(["\n  padding: 4px 20px;\n  background: transparent;\n  border: none;\n  display: flex;\n  align-items: center;\n  color: rgb(28, 29, 28);\n  width: 100%;\n  & img {\n    margin-right: 5px;\n  }\n  ",";\n"])),(function(e){return e.focus&&"\n    background: #1264a3;\n    color: white;\n  "})),v=t(83564),x=t(67294),y=t(3682),w=t(16550),k=t(95591),E=t(66182),_=t.n(E);const Z=function(e){var n=e.chat,t=e.onSubmitForm,r=e.onChangeChat,a=e.placeholder,o=(0,w.UO)().workspace,l=(0,k.ZP)("/api/users",v.Z,{dedupingInterval:2e3}),i=l.data,c=(l.error,l.mutate,(0,k.ZP)(i?"/api/workspaces/".concat(o,"/members"):null,v.Z).data),u=(0,x.useRef)(null);(0,x.useEffect)((function(){u.current&&(0,y.Z)(u.current)}),[]);var d=(0,x.useCallback)((function(e){"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),t(e)))}),[t]),E=(0,x.useCallback)((function(e,n,t,r,a){if(c)return x.createElement(b,{focus:a},x.createElement("img",{src:_().url(c[r].email,{s:"20px",d:"retro"}),alt:c[r].nickname}),x.createElement("span",null,t))}),[c]);return x.createElement(p,null,x.createElement(f,{onSubmit:t},x.createElement(m,{id:"editor-chat",value:n,onChange:r,onKeyPress:d,placeholder:a,inputRef:u,allowSuggestionsAboveCursor:!0},x.createElement(s.p,{appendSpaceOnAdd:!0,trigger:"@",data:(null==c?void 0:c.map((function(e){return{id:e.id,display:e.nickname}})))||[],renderSuggestion:E})),x.createElement(h,null,x.createElement(g,{className:"c-button-unstyled c-icon_button c-icon_button--light c-icon_button--size_medium c-texty_input__button c-texty_input__button--send"+(null!=n&&n.trim()?"":" c-texty_input__button--disabled"),"data-qa":"texty_send_button","aria-label":"Send message","data-sk":"tooltip_parent",type:"submit",disabled:!(null!=n&&n.trim())},x.createElement("i",{className:"c-icon c-icon--paperplane-filled","aria-hidden":"true"})))))}},32545:(e,n,t)=>{t.d(n,{Z:()=>C});var r,a,o,l=t(67294),i=t(5996),c=i.Z.div(r||(a=["\n  display: flex;\n  padding: 8px 20px;\n  &:hover {\n    background: #eee;\n  }\n  & .chat-img {\n    display: flex;\n    width: 36px;\n    margin-right: 8px;\n    & img {\n      width: 36px;\n      height: 36px;\n    }\n  }\n"],o||(o=a.slice(0)),r=Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(o)}})))),u=t(66182),s=t.n(u),d=t(27484),p=t.n(d),f=t(38817),m=t(16550),h=t(73727),g=function(e){var n=e.data,t=(0,m.UO)().workspace,r="Sender"in n?n.Sender:n.User,a=(0,l.useMemo)((function(){return(0,f.Z)({input:n.content,pattern:/@\[(.+?)]\((\d+?)\)|\n/g,decorator:function(e,n){var r=e.match(/@\[(.+?)]\((\d+?)\)/);return r?l.createElement(h.rU,{key:e+n,to:"/workspace/".concat(t,"/dm/").concat(r[2])},"@",r[1]):l.createElement("br",{key:n})}})}),[n.content]);return l.createElement(c,null,l.createElement("div",{className:"chat-img"},l.createElement("img",{src:s().url(r.email,{s:"36px",d:"retro"}),alt:r.nickname})),l.createElement("div",{className:"chat-text"},l.createElement("div",{className:"chat-user"},l.createElement("b",null,r.nickname),l.createElement("span",null,p()(n.createdAt).format("h:mm A"))),l.createElement("p",null,a)))};const b=(0,l.memo)(g);var v,x,y;function w(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var k=i.Z.div(v||(v=w(["\n  width: 100%;\n  display: flex;\n  flex: 1;\n"]))),E=i.Z.section(x||(x=w(["\n  margin-top: 20px;\n  border-top: 1px solid #eee;\n"]))),_=i.Z.div(y||(y=w(["\n  display: flex;\n  justify-content: center;\n  flex: 1;\n  width: 100%;\n  position: sticky;\n  top: 14px;\n  & button {\n    font-weight: bold;\n    font-size: 13px;\n    height: 28px;\n    line-height: 27px;\n    padding: 0 16px;\n    z-index: 2;\n    --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n    box-shadow: 0 0 0 1px var(--saf-0), 0 1px 3px 0 rgba(0, 0, 0, 0.08);\n    border-radius: 24px;\n    position: relative;\n    top: -13px;\n    background: white;\n    border: none;\n    outline: none;\n  }\n"]))),Z=t(31298);function S(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}const C=(0,l.forwardRef)((function(e,n){var t=e.chatSections,r=e.setSize,a=e.isReachingEnd,o=(0,l.useCallback)((function(e){0!==e.scrollTop||a||(console.log("가장 위"),r((function(e){return e+1})).then((function(){var t=null==n?void 0:n.current;t&&t.scrollTop(t.getScrollHeight()-e.scrollHeight)})))}),[n,a,r]);return l.createElement(k,null,l.createElement(Z.$B,{autoHide:!0,ref:n,onScrollFrame:o},Object.entries(t).map((function(e){var n,t,r=(t=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,l,i=[],c=!0,u=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=o.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw a}}return i}}(n,t)||function(e,n){if(e){if("string"==typeof e)return S(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(e,n):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],o=r[1];return l.createElement(E,{className:"section-".concat(a),key:a},l.createElement(_,null,l.createElement("button",null,a)),o.map((function(e){return l.createElement(b,{key:e.id,data:e})})))}))))}))},65256:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var r,a,o=t(92309),l=t(32545),i=t(79250),c=t(38678),u=t(32951),s=t(5996);function d(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var p=s.Z.div(r||(r=d(["\n  display: flex;\n  flex-wrap: wrap;\n  height: calc(100vh - 38px);\n  flex-flow: column;\n  position: relative;\n"]))),f=s.Z.header(a||(a=d(["\n  height: 64px;\n  display: flex;\n  width: 100%;\n  --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n  box-shadow: 0 1px 0 var(--saf-0);\n  padding: 20px 16px 20px 20px;\n  font-weight: bold;\n  align-items: center;\n\n  & .header-right {\n    display: flex;\n    flex: 1;\n    justify-content: flex-end;\n    align-items: center;\n  }\n"]))),m=t(83564),h=t(18667),g=t(9669),b=t.n(g),v=t(67294),x=t(16550),y=t(95591),w=t(44593);function k(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,l,i=[],c=!0,u=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=o.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw a}}return i}}(e,n)||function(e,n){if(e){if("string"==typeof e)return E(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}const _=function(){var e,n,t=(0,x.UO)(),r=t.workspace,a=t.channel,s=(0,y.ZP)("/api/users",m.Z).data,d=k((0,c.Z)(""),3),g=d[0],E=d[1],_=d[2],Z=(0,y.ZP)("/api/workspaces/".concat(r,"/channels/").concat(a),m.Z).data,S=(0,w.ZP)((function(e){return"/api/workspaces/".concat(r,"/channels/").concat(a,"/chats?perPage=20&page=").concat(e+1)}),m.Z),C=S.data,O=S.mutate,j=S.mutate,A=S.setSize,T=(0,y.ZP)(s?"/api/workspaces/".concat(r,"/channels/").concat(a,"/members"):null,m.Z).data,z=k((0,u.Z)(r),1)[0],P=0===(null==C||null===(e=C[0])||void 0===e?void 0:e.length)||C&&(null===(n=C[C.length-1])||void 0===n?void 0:n.length)<20||!1,D=(0,v.useRef)(null),I=k((0,v.useState)(!1),2),U=I[0],N=I[1],F=k((0,v.useState)(!1),2),M=(F[0],F[1]),B=(0,v.useCallback)((function(e){if(e.preventDefault(),console.log(g),null!=g&&g.trim()&&C&&Z){var n=g;O((function(e){var t;return null==e||e[0].unshift({id:((null===(t=C[0][0])||void 0===t?void 0:t.id)||0)+1,content:n,UserId:s.id,User:s,ChannelId:Z.id,Channel:Z,createdAt:new Date}),e}),!1).then((function(){var e;_(""),null===(e=D.current)||void 0===e||e.scrollToBottom()})),b().post("/api/workspaces/".concat(r,"/channels/").concat(a,"/chats"),{content:g}).then((function(){j()})).catch(console.error)}}),[g,C,s,Z,r,a]),R=(0,v.useCallback)((function(e){e.Channel.name!==a||!e.content.startsWith("uploads\\")&&e.UserId===(null==s?void 0:s.id)||O((function(n){return null==n||n[0].unshift(e),n}),!1).then((function(){var e;D.current&&D.current.getScrollHeight()<D.current.getClientHeight()+D.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=D.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=D.current)||void 0===e||e.scrollToBottom()}),50))}))}),[a,s]);(0,v.useEffect)((function(){return null==z||z.on("message",R),function(){null==z||z.off("message",R)}}),[z,R]),(0,v.useEffect)((function(){1===(null==C?void 0:C.length)&&(console.log("toBottomWhenLoaded",D.current),setTimeout((function(){var e;console.log("scrollbar",D.current),null===(e=D.current)||void 0===e||e.scrollToBottom()}),500))}),[C]);var H=(0,v.useCallback)((function(){N(!0)}),[]),Y=(0,v.useCallback)((function(){N(!1)}),[]),L=((0,v.useCallback)((function(e){var n=new FormData;if(e.target.files)for(var t=0;t<e.target.files.length;t++){var o=e.target.files[t].getAsFile();console.log("... file["+t+"].name = "+o.name),n.append("image",o)}b().post("/api/workspaces/".concat(r,"/channels/").concat(a,"/images"),n).then((function(){}))}),[]),(0,v.useCallback)((function(e){e.preventDefault(),console.log(e);var n=new FormData;if(e.dataTransfer.items){for(var t=0;t<e.dataTransfer.items.length;t++)if("file"===e.dataTransfer.items[t].kind){var o=e.dataTransfer.items[t].getAsFile();console.log(e,".... file["+t+"].name = "+o.name),n.append("image",o)}}else for(var l=0;l<e.dataTransfer.files.length;l++)console.log(e,"... file["+l+"].name = "+e.dataTransfer.files[l].name),n.append("image",e.dataTransfer.files[l]);b().post("/api/workspaces/".concat(r,"/channels/").concat(a,"/images"),n).then((function(){M(!1)}))}),[r,a])),$=(0,v.useCallback)((function(e){e.preventDefault(),console.log(e),M(!0)}),[]);if(!s)return null;var K=(0,h.Z)(C?C.flat().reverse():[]);return v.createElement(p,{onDrop:L,onDragOver:$},v.createElement(f,null,v.createElement("span",null,"#",a),v.createElement("div",{className:"header-right"},v.createElement("span",null,null==T?void 0:T.length),v.createElement("button",{onClick:H,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},v.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),v.createElement(l.Z,{chatSections:K,ref:D,setSize:A,isReachingEnd:P}),v.createElement(o.Z,{chat:g,onChangeChat:E,onSubmitForm:B}),v.createElement(i.Z,{show:U,onCloseModal:Y,setShowInviteChannelModal:N}))}},18667:(e,n,t)=>{t.d(n,{Z:()=>o});var r=t(27484),a=t.n(r);function o(e){var n={};return e.forEach((function(e){var t=a()(e.createdAt).format("YYYY-MM-DD");Array.isArray(n[t])?n[t].push(e):n[t]=[e]})),n}}}]);