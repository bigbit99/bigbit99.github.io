{"version":3,"file":"94.js","mappings":"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","sources":["webpack://sleact-ts-front/./components/ChatBox/styles.tsx","webpack://sleact-ts-front/./components/ChatBox/index.tsx","webpack://sleact-ts-front/./components/Chat/styles.tsx","webpack://sleact-ts-front/./components/Chat/index.tsx","webpack://sleact-ts-front/./components/ChatList/styles.tsx","webpack://sleact-ts-front/./components/ChatList/index.tsx","webpack://sleact-ts-front/./pages/DirectMessage/styles.tsx","webpack://sleact-ts-front/./pages/DirectMessage/index.tsx","webpack://sleact-ts-front/./utils/makeSection.ts"],"sourcesContent":["import styled from '@emotion/styled';\nimport { MentionsInput } from 'react-mentions';\n\nexport const ChatArea = styled.div`\n  display: flex;\n  width: 100%;\n  padding: 20px;\n  padding-top: 0;\n`;\n\nexport const Form = styled.form`\n  color: rgb(29, 28, 29);\n  font-size: 15px;\n  width: 100%;\n  border-radius: 4px;\n  border: 1px solid rgb(29, 28, 29);\n`;\n\nexport const MentionsTextarea = styled(MentionsInput)`\n  font-family: Slack-Lato, appleLogo, sans-serif;\n  font-size: 15px;\n  padding: 8px 9px;\n  width: 100%;\n  & strong {\n    background: skyblue;\n  }\n  & textarea {\n    height: 44px;\n    padding: 9px 10px !important;\n    outline: none !important;\n    border-radius: 4px !important;\n    resize: none !important;\n    line-height: 22px;\n    border: none;\n  }\n  & ul {\n    border: 1px solid lightgray;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 9px 10px;\n    background: white;\n    border-radius: 4px;\n    width: 150px;\n  }\n`;\n\nexport const Toolbox = styled.div`\n  position: relative;\n  background: rgb(248, 248, 248);\n  height: 41px;\n  display: flex;\n  border-top: 1px solid rgb(221, 221, 221);\n  align-items: center;\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n`;\n\nexport const SendButton = styled.button`\n  position: absolute;\n  right: 5px;\n  top: 5px;\n`;\n\nexport const EachMention = styled.button<{ focus: boolean }>`\n  padding: 4px 20px;\n  background: transparent;\n  border: none;\n  display: flex;\n  align-items: center;\n  color: rgb(28, 29, 28);\n  width: 100%;\n  & img {\n    margin-right: 5px;\n  }\n  ${({ focus }) =>\n    focus &&\n    `\n    background: #1264a3;\n    color: white;\n  `};\n`;\n","import { ChatArea, EachMention, Form, MentionsTextarea, SendButton, Toolbox } from '@components/ChatBox/styles';\nimport { IUser } from '@typings/db';\nimport fetcher from '@utils/fetcher';\nimport React, { useCallback, useEffect, useRef, VFC } from 'react';\nimport autosize from 'autosize';\nimport { Mention, SuggestionDataItem } from 'react-mentions';\nimport { useParams } from 'react-router';\nimport useSWR from 'swr';\nimport gravatar from 'gravatar';\n\ninterface Props {\n  chat: string;\n  onSubmitForm: (e: any) => void;\n  onChangeChat: (e: any) => void;\n  placeholder?: string;\n}\nconst ChatBox: VFC<Props> = ({ chat, onSubmitForm, onChangeChat, placeholder }) => {\n  const { workspace } = useParams<{ workspace: string }>();\n  const {\n    data: userData,\n    error,\n    mutate,\n  } = useSWR<IUser | false>('/api/users', fetcher, {\n    dedupingInterval: 2000, // 2초\n  });\n  const { data: memberData } = useSWR<IUser[]>(userData ? `/api/workspaces/${workspace}/members` : null, fetcher);\n\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  useEffect(() => {\n    if (textareaRef.current) {\n      autosize(textareaRef.current);\n    }\n  }, []);\n\n  const onKeydownChat = useCallback(\n    (e) => {\n      if (e.key === 'Enter') {\n        if (!e.shiftKey) {\n          e.preventDefault();\n          onSubmitForm(e);\n        }\n      }\n    },\n    [onSubmitForm],\n  );\n\n  const renderSuggestion = useCallback(\n    (\n      suggestion: SuggestionDataItem,\n      search: string,\n      highlightedDisplay: React.ReactNode,\n      index: number,\n      focus: boolean,\n    ): React.ReactNode => {\n      if (!memberData) return;\n      return (\n        <EachMention focus={focus}>\n          <img\n            src={gravatar.url(memberData[index].email, { s: '20px', d: 'retro' })}\n            alt={memberData[index].nickname}\n          />\n          <span>{highlightedDisplay}</span>\n        </EachMention>\n      );\n    },\n    [memberData],\n  );\n\n  return (\n    <ChatArea>\n      <Form onSubmit={onSubmitForm}>\n        <MentionsTextarea\n          id=\"editor-chat\"\n          value={chat}\n          onChange={onChangeChat}\n          onKeyPress={onKeydownChat}\n          placeholder={placeholder}\n          inputRef={textareaRef}\n          allowSuggestionsAboveCursor\n        >\n          <Mention\n            appendSpaceOnAdd\n            trigger=\"@\"\n            data={memberData?.map((v) => ({ id: v.id, display: v.nickname })) || []}\n            renderSuggestion={renderSuggestion}\n          />\n        </MentionsTextarea>\n        <Toolbox>\n          <SendButton\n            className={\n              'c-button-unstyled c-icon_button c-icon_button--light c-icon_button--size_medium c-texty_input__button c-texty_input__button--send' +\n              (chat?.trim() ? '' : ' c-texty_input__button--disabled')\n            }\n            data-qa=\"texty_send_button\"\n            aria-label=\"Send message\"\n            data-sk=\"tooltip_parent\"\n            type=\"submit\"\n            disabled={!chat?.trim()}\n          >\n            <i className=\"c-icon c-icon--paperplane-filled\" aria-hidden=\"true\" />\n          </SendButton>\n        </Toolbox>\n      </Form>\n    </ChatArea>\n  );\n};\n\nexport default ChatBox;\n","import styled from '@emotion/styled';\n\nexport const ChatWrapper = styled.div`\n  display: flex;\n  padding: 8px 20px;\n  &:hover {\n    background: #eee;\n  }\n  & .chat-img {\n    display: flex;\n    width: 36px;\n    margin-right: 8px;\n    & img {\n      width: 36px;\n      height: 36px;\n    }\n  }\n`;\n","import { IDM, IChat } from '@typings/db';\nimport React, { VFC, memo, useMemo } from 'react';\nimport { ChatWrapper } from '@components/Chat/styles';\nimport gravatar from 'gravatar';\nimport dayjs from 'dayjs';\nimport regexifyString from 'regexify-string';\nimport { Link, useParams } from 'react-router-dom';\n\ninterface Props {\n  data: IDM | IChat;\n}\n\nconst Chat: VFC<Props> = ({ data }) => {\n  const { workspace } = useParams<{ workspace: string; channel: string }>();\n  const user = 'Sender' in data ? data.Sender : data.User; //타입가드\n\n  const result = useMemo(\n    () =>\n      regexifyString({\n        input: data.content,\n        pattern: /@\\[(.+?)]\\((\\d+?)\\)|\\n/g,\n        decorator(match, index) {\n          const arr: string[] | null = match.match(/@\\[(.+?)]\\((\\d+?)\\)/)!;\n          if (arr) {\n            return (\n              <Link key={match + index} to={`/workspace/${workspace}/dm/${arr[2]}`}>\n                @{arr[1]}\n              </Link>\n            );\n          }\n          return <br key={index} />;\n        },\n      }),\n    [data.content],\n  );\n  //\\d 는 숫자 , +는 1개 이상 , ?는 0개나 1개 , *이 0개 이상 , g는 모두찾기\n\n  return (\n    <ChatWrapper>\n      <div className=\"chat-img\">\n        <img src={gravatar.url(user.email, { s: '36px', d: 'retro' })} alt={user.nickname} />\n      </div>\n      <div className=\"chat-text\">\n        <div className=\"chat-user\">\n          <b>{user.nickname}</b>\n          <span>{dayjs(data.createdAt).format('h:mm A')}</span>\n        </div>\n        <p>{result}</p>\n      </div>\n    </ChatWrapper>\n  );\n};\n\nexport default memo(Chat);\n","import styled from '@emotion/styled';\n\nexport const ChatZone = styled.div`\n  width: 100%;\n  display: flex;\n  flex: 1;\n`;\n\nexport const Section = styled.section`\n  margin-top: 20px;\n  border-top: 1px solid #eee;\n`;\n\nexport const StickyHeader = styled.div`\n  display: flex;\n  justify-content: center;\n  flex: 1;\n  width: 100%;\n  position: sticky;\n  top: 14px;\n  & button {\n    font-weight: bold;\n    font-size: 13px;\n    height: 28px;\n    line-height: 27px;\n    padding: 0 16px;\n    z-index: 2;\n    --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n    box-shadow: 0 0 0 1px var(--saf-0), 0 1px 3px 0 rgba(0, 0, 0, 0.08);\n    border-radius: 24px;\n    position: relative;\n    top: -13px;\n    background: white;\n    border: none;\n    outline: none;\n  }\n`;\n","import Chat from '@components/Chat';\nimport { ChatZone, Section, StickyHeader } from '@components/ChatList/styles';\nimport { IDM, IChat } from '@typings/db';\nimport React, { useCallback, forwardRef, RefObject, MutableRefObject } from 'react';\nimport { Scrollbars } from 'react-custom-scrollbars';\n\ninterface Props {\n  chatSections: { [key: string]: (IDM | IChat)[] };\n  setSize: (f: (size: number) => number) => Promise<(IDM | IChat)[][] | undefined>;\n  isReachingEnd: boolean;\n}\nconst ChatList = forwardRef<Scrollbars, Props>(({ chatSections, setSize, isReachingEnd }, scrollRef) => {\n  const onScroll = useCallback(\n    (values) => {\n      if (values.scrollTop === 0 && !isReachingEnd) {\n        console.log('가장 위');\n        setSize((prevSize) => prevSize + 1).then(() => {\n          // 스크롤 위치 유지\n          const current = (scrollRef as MutableRefObject<Scrollbars>)?.current;\n          if (current) {\n            current.scrollTop(current.getScrollHeight() - values.scrollHeight);\n          }\n        });\n      }\n    },\n    [scrollRef, isReachingEnd, setSize],\n  );\n\n  return (\n    <ChatZone>\n      <Scrollbars autoHide ref={scrollRef} onScrollFrame={onScroll}>\n        {Object.entries(chatSections).map(([date, chats]) => {\n          return (\n            <Section className={`section-${date}`} key={date}>\n              <StickyHeader>\n                <button>{date}</button>\n              </StickyHeader>\n              {chats.map((chat) => (\n                <Chat key={chat.id} data={chat} />\n              ))}\n            </Section>\n          );\n        })}\n      </Scrollbars>\n    </ChatZone>\n  );\n});\n\nexport default ChatList;\n\n// import Chat from '@components/Chat';\n// import { ChatZone, Section, StickyHeader } from '@components/ChatList/styles';\n// import { IDM, IChat } from '@typings/db';\n// import React, { useCallback, forwardRef, RefObject, MutableRefObject, useRef, VFC } from 'react';\n// import { Scrollbars } from 'react-custom-scrollbars';\n\n// interface Props {\n//   chatSections: { [key: string]: (IDM | IChat)[] };\n//   setSize: (f: (size: number) => number) => Promise<(IDM | IChat)[][] | undefined>;\n//   isEmpty: boolean;\n//   isReachingEnd: boolean;\n//   scrollRef: RefObject<Scrollbars>;\n// }\n// const ChatList = forwardRef<Scrollbars, Props>(({ chatSections, setSize, scrollRef, isEmpty, isReachingEnd }) => {\n//   const onScroll = useCallback((values) => {\n//     if (values.scrollTop === 0 && !isReachingEnd) {\n//       console.log('가장 위');\n//       //데이터추가 로딩!\n//       setSize((prevSize) => prevSize + 1).then(() => {\n//         //스크롤 위치 유지\n//         if (scrollRef?.current) {\n//           console.log(scrollRef.current?.getScrollHeight(), values.scrollHeight);\n//           scrollRef.current?.scrollTop(scrollRef.current?.getScrollHeight() - values.scrollHeight);\n//         }\n//       });\n//     }\n//   }, []);\n\n//   return (\n//     <ChatZone>\n//       <Scrollbars autoHide ref={scrollRef} onScrollFrame={onScroll}>\n//         {Object.entries(chatSections).map(([date, chats]) => {\n//           return (\n//             <Section className={`section-${date}`} key={date}>\n//               <StickyHeader>\n//                 <button>{date}</button>\n//               </StickyHeader>\n//               {chats.map((chat) => (\n//                 <Chat key={chat.id} data={chat} />\n//               ))}\n//             </Section>\n//           );\n//         })}\n//       </Scrollbars>\n//     </ChatZone>\n//   );\n// });\n\n// export default ChatList;\n","import styled from '@emotion/styled';\n\nexport const Container = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  height: calc(100vh - 38px);\n  flex-flow: column;\n  position: relative;\n`;\n\nexport const Header = styled.header`\n  height: 64px;\n  display: flex;\n  width: 100%;\n  --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n  box-shadow: 0 1px 0 var(--saf-0);\n  padding: 20px 16px 20px 20px;\n  font-weight: bold;\n  align-items: center;\n  & img {\n    margin-right: 5px;\n  }\n`;\n\nexport const DragOver = styled.div`\n  position: absolute;\n  top: 64px;\n  left: 0;\n  width: 100%;\n  height: calc(100% - 64px);\n  background: white;\n  opacity: 0.7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40px;\n`;\n","import React, { useCallback, useEffect, useRef } from 'react';\nimport fetcher from '@utils/fetcher';\nimport { Container, Header } from '@pages/DirectMessage/styles';\nimport gravatar from 'gravatar';\nimport { useParams } from 'react-router';\nimport ChatBox from '@components/ChatBox';\nimport ChatList from '@components/ChatList';\nimport useInput from '@hooks/useInput';\nimport axios from 'axios';\nimport { IDM, IUser } from '@typings/db';\nimport makeSection from '@utils/makeSection';\nimport Scrollbars from 'react-custom-scrollbars';\nimport useSWR from 'swr';\nimport useSWRInfinite from 'swr/infinite';\nimport { Socket } from 'socket.io-client';\nimport useSocket from '@hooks/useSocket';\n\nconst DirectMessage = () => {\n  const { workspace, id } = useParams<{ workspace: string; id: string }>();\n  const { data: userData } = useSWR(`/api/workspaces/${workspace}/users/${id}`, fetcher);\n  const { data: myData } = useSWR(`/api/users`, fetcher);\n\n  const [chat, onChangeChat, setChat] = useInput('');\n\n  const {\n    data: chatData,\n    mutate: mutateChat,\n    mutate,\n    setSize, //페이지 수 바꿔주는 역할\n  } = useSWRInfinite<IDM[]>(\n    (index) => `/api/workspaces/${workspace}/dms/${id}/chats?perPage=20&page=${index + 1}`, //채팅 받아오는 api\n    fetcher,\n  );\n\n  const [socket] = useSocket(workspace);\n\n  //setSize와 관련된 변수 선언\n  const isEmpty = chatData?.[0]?.length === 0;\n  const isReachingEnd = isEmpty || (chatData && chatData[chatData.length - 1]?.length < 20) || false;\n\n  const scrollbarRef = useRef<Scrollbars>(null);\n\n  const onSubmitForm = useCallback(\n    (e) => {\n      e.preventDefault();\n      console.log(chat);\n      if (chat?.trim() && chatData) {\n        const savedChat = chat;\n        mutateChat((prevChatData) => {\n          prevChatData?.[0].unshift({\n            id: (chatData[0][0]?.id || 0) + 1,\n            content: savedChat,\n            SenderId: myData.id,\n            Sender: myData,\n            ReceiverId: userData.id,\n            Receiver: userData,\n            createdAt: new Date(),\n          });\n          return prevChatData;\n        }, false).then(() => {\n          setChat('');\n          scrollbarRef.current?.scrollToBottom();\n        });\n        axios\n          .post(`/api/workspaces/${workspace}/dms/${id}/chats`, {\n            content: chat,\n          })\n          .then(() => {\n            mutate();\n          })\n          .catch(console.error);\n      }\n    },\n    [chat, chatData, myData, userData, workspace, id],\n  );\n\n  const onMessage = useCallback((data: IDM) => {\n    // id는 상대방 아이디\n    if (data.SenderId === Number(id) && myData.id !== Number(id)) {\n      mutateChat((chatData) => {\n        //소켓io가 서버로 부터 데이터를 실시간으로 가져다줌.\n        chatData?.[0].unshift(data); //가장 최신 배열에 가장 최신 데이터를 넣음.\n        return chatData;\n      }, false).then(() => {\n        if (scrollbarRef.current) {\n          if (\n            scrollbarRef.current.getScrollHeight() <\n            scrollbarRef.current.getClientHeight() + scrollbarRef.current.getScrollTop() + 150\n          ) {\n            console.log('scrollToBottom!', scrollbarRef.current?.getValues());\n            //시간차 조절\n            setTimeout(() => {\n              scrollbarRef.current?.scrollToBottom();\n            }, 50);\n          }\n        }\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    socket?.on('dm', onMessage);\n    return () => {\n      socket?.off('dm', onMessage);\n    };\n  }, [socket, onMessage]);\n\n  //로딩 시 스크롤바 제일 아래로.\n  useEffect(() => {\n    if (chatData?.length === 1) {\n      scrollbarRef.current?.scrollToBottom();\n    }\n  }, [chatData]);\n\n  if (!userData || !myData) {\n    return null;\n  }\n\n  const chatSections = makeSection(chatData ? chatData.flat().reverse() : []);\n  //concat - 불변성 지켜주는 메서드 / 기존껀 가만있고 새로운 배열 생성해줌. [...]스프레드 연산자\n\n  return (\n    <Container>\n      <Header>\n        <img src={gravatar.url(userData.email, { s: '24px', d: 'retro' })} alt={userData.nickname} />\n        <span>{userData.nickname}</span>\n      </Header>\n      <ChatList chatSections={chatSections} ref={scrollbarRef} setSize={setSize} isReachingEnd={isReachingEnd} />\n      <ChatBox chat={chat} onChangeChat={onChangeChat} onSubmitForm={onSubmitForm} />\n    </Container>\n  );\n};\n\nexport default DirectMessage;\n","import { IDM, IChat } from '@typings/db';\nimport dayjs from 'dayjs';\n\nexport default function makeSection(chatList: (IDM | IChat)[]) {\n  const sections: { [key: string]: (IDM | IChat)[] } = {};\n  chatList.forEach((chat) => {\n    const monthDate = dayjs(chat.createdAt).format('YYYY-MM-DD');\n    if (Array.isArray(sections[monthDate])) {\n      sections[monthDate].push(chat);\n    } else {\n      sections[monthDate] = [chat];\n    }\n  });\n  return sections;\n}\n"],"names":["ChatArea","styled","_templateObject","_taggedTemplateLiteral","Form","_templateObject2","MentionsTextarea","MentionsInput","_templateObject3","Toolbox","_templateObject4","SendButton","_templateObject5","EachMention","_templateObject6","_ref","focus","chat","onSubmitForm","onChangeChat","placeholder","workspace","useParams","_useSWR","useSWR","fetcher","dedupingInterval","userData","data","memberData","error","mutate","concat","textareaRef","useRef","useEffect","current","autosize","onKeydownChat","useCallback","e","key","shiftKey","preventDefault","renderSuggestion","suggestion","search","highlightedDisplay","index","React","src","gravatar","email","s","d","alt","nickname","onSubmit","id","value","onChange","onKeyPress","inputRef","allowSuggestionsAboveCursor","Mention","appendSpaceOnAdd","trigger","map","v","display","className","trim","type","disabled","ChatWrapper","Chat","user","Sender","User","result","useMemo","regexifyString","input","content","pattern","decorator","match","arr","Link","to","dayjs","createdAt","format","memo","ChatZone","Section","StickyHeader","forwardRef","scrollRef","chatSections","setSize","isReachingEnd","onScroll","values","scrollTop","console","log","prevSize","then","getScrollHeight","scrollHeight","Scrollbars","autoHide","ref","onScrollFrame","Object","entries","_ref2","_ref3","date","chats","Container","Header","_chatData$","_chatData","_useParams","myData","_useInput2","_slicedToArray","useInput","setChat","_useSWRInfinite","useSWRInfinite","chatData","mutateChat","socket","useSocket","length","scrollbarRef","savedChat","prevChatData","_chatData$0$","unshift","SenderId","ReceiverId","Receiver","Date","_scrollbarRef$current","scrollToBottom","axios","catch","onMessage","Number","_scrollbarRef$current2","getClientHeight","getScrollTop","getValues","setTimeout","_scrollbarRef$current3","on","off","_scrollbarRef$current4","makeSection","flat","reverse","ChatList","ChatBox","chatList","sections","forEach","monthDate","Array","isArray","push"],"sourceRoot":""}